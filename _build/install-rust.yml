parameters:
  rustup_toolchain: ''

steps:
 - ${{ each pair in variables }}:
   - script: echo ${{ pair.key }} ${{ pair.value }}
     displayName: ${{ pair.key }} ${{ pair.value }}
 - bash: |
     env
     TOOLCHAIN="${{parameters['rustup_toolchain']}}"
     TOOLCHAIN="${TOOLCHAIN:-$RUSTUP_TOOLCHAIN}"
     TOOLCHAIN="${TOOLCHAIN:-stable}"
     echo "##vso[task.setvariable variable=TOOLCHAIN;]$TOOLCHAIN"
   displayName: Set rust toolchain
 - ${{ if contains( variables['SYSTEMROOT'], 'windows' ) }}:
   - script: |
       curl -sSf -o rustup-init.exe https://win.rustup.rs
       rustup-init.exe -y --default-toolchain %TOOLCHAIN%
       echo "##vso[task.setvariable variable=PATH;]%PATH%;%USERPROFILE%\.cargo\bin"
     displayName: Windows install rust
 - ${{ if ne( variables['OS'], 'Windows_NT' ) }}:
   - script: |
       curl https://sh.rustup.rs -sSf | sh -s -- -y --default-toolchain $TOOLCHAIN
       echo "##vso[task.setvariable variable=PATH;]$PATH:$HOME/.cargo/bin"
     displayName: Install rust
